<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Veckoschema</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Introduktion till databehandling (MT3003)</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Hem</a>
</li>
<li>
  <a href="schedule.html">Veckoshema</a>
</li>
<li>
  <a href="lab.html">Laborationer</a>
</li>
<li>
  <a href="project.html">Projekt</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Veckoschema</h1>

</div>


<div id="v23-introduktion-till-kursverktyg" class="section level2">
<h2><strong>v23</strong>: Introduktion till kursverktyg</h2>
<p>Den första veckan kommer innehålla administration och avslutas med en provkörning av kursverktygen i laboration 1.</p>
<div id="mål-denna-vecka" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Dina kurskonto på <a href="https://github.com/">GitHub</a> och <a href="https://rstudio.cloud/">RStudio Cloud</a> skall vara kopplade till kursens arbetsytor.</li>
<li>Första laborationen inlämnad. (Deadline söndag).</li>
</ul>
</div>
<div id="kursmaterial" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>Hadley Wickham and Garrett Grolemund, <em>R for Data Science</em> (i fortsättningen R4DS): <a href="https://r4ds.had.co.nz/introduction.html">Kapitel 1, Introduction</a>.</li>
<li>Ett antal filmer som publiceras här i samband med kurstart.</li>
<li><a href="https://kurser.math.su.se/pluginfile.php/140337/mod_resource/content/1/betygskriterier.pdf">Examination och betyg (kurshemsida)</a></li>
</ul>
<hr />
</div>
</div>
<div id="v24-enkla-visualiseringar" class="section level2">
<h2><strong>v24</strong>: Enkla visualiseringar</h2>
<div id="mål-denna-vecka-1" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Att ha grundläggande förståelse för Rs datatyper.</li>
<li>Att kunna skapa enkla diagram och förstå de grundläggande komponenterna i en <code>ggplot</code>-visualisering (<code>data</code>, <code>mapping</code>, <code>geom</code>).</li>
</ul>
</div>
<div id="kursmaterial-1" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>R4DS: <a href="https://r4ds.had.co.nz/introduction.html">Kapitel 2-4</a>.</li>
</ul>
<p>RStudio Primers:</p>
<ul>
<li><a href="https://rstudio.cloud/learn/primers/1">The Basics</a> (Vizualisation och Programming)</li>
<li><a href="https://rstudio.cloud/learn/primers/2.1">Working with tibbles</a></li>
</ul>
</div>
<div id="övningar" class="section level3">
<h3>Övningar</h3>
<p>Under rubriken övningar hittar du träningsmaterial som inte ingår i kursens examination. Detta ger bra övning inför inlämningsuppgifterna, med fördelen att du kan fråga och tipsa hur mycket du vill på kursens Discord. Skapa ett separat projekt i RStudio Cloud där du arbetar med övningar och skapa en mapp <code>data</code> i detta projekt där du kan spara de datamaterial vi använder.</p>
<p>Gör inte bara uppgifterna utan experimentera med data och försök hitta på egna frågeställningar att besvara, fråga på Discord om något inte blev som du tänkt.</p>
<div id="ettor-på-stan" class="section level4">
<h4>Ettor på stan</h4>
<p>Du kan ladda ner en kopia av data från inlämningsuppgift 1 med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/booli_ettor_2022-05-19.csv&quot;,
              &quot;data/booli_ettor_2022-05-19.csv&quot;)</code></pre>
<p>och läsa in den med</p>
<pre class="r"><code>booli_ettor &lt;- read_csv(&quot;data/booli_ettor_2022-05-19.csv&quot;)</code></pre>
<p>Notera att det går bra att läsa direkt från en url, som i</p>
<pre class="r"><code>booli_ettor &lt;- read_csv(&quot;https://github.com/MT3003-ST22/data/raw/main/booli_ettor_2022-05-19.csv&quot;)</code></pre>
<p>men vi föredrar att ladda ner filen en gång, då kan vi vara säkra på att vi arbetar med samma material nästa gång vi öppnar projektet. Använd din egen fantasi för att undersöka materialet med enkla figurer, till exempel kan du undersöka</p>
<ul>
<li>Hur påverkar yta (<code>livingArea</code>) hyran (<code>rent</code>)?</li>
<li>Media rapporterar ibland om <a href="https://www.svt.se/nyheter/inrikes/rekordmanga-anmalningar-om-lockpriser">anmälningar om lockpriser</a>. Undersök hur förekomsten av lockpriser varierat genom att plotta kvoten mellan slutpris och utgångspris (<code>soldPrice / listPrice</code>) mot försäljningsdatum (<code>soldDate</code>). Tips: Om figuren förstörs av ett extremt värde kan du zooma in genom att lägga till <code>+ ylim(c(0, 2))</code> för att bestämma gränserna på <code>y</code>-axeln.</li>
<li>Vilka veckodagar publicerar mäklarna sina annonser? Gör ett stapeldiagram över antalet annonser per veckodag, veckodag får du genom <code>weekdays(published)</code>.</li>
</ul>
<p><em>Faktorvariabler:</em> Ovanstående övning illustrerar ett vanligt problem. Veckodagarna blir sorterade i alfabetisk ordning medan vi antagligen vill ha dem i kronologisk. Problemet kommer av att en variabel av typen <code>character</code> inte innehåller någon information om kategoriernas ordning, det gör däremot en variabel av typen <code>factor</code>. För att ändra ordning behöver vi alltså göra om <code>weekdays(published)</code> till en faktorvariabel. Om vi istället för <code>weekdays(published)</code> använder <code>factor(weekdays(published), levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))</code> så ordnas staplarna i den ordning vi angett.</p>
</div>
<div id="systembolagets-katalog" class="section level4">
<h4>Systembolagets katalog</h4>
<p>Systembolaget brukade ha hela sin katalog öppen för nedladdning, <a href="https://api-portal.systembolaget.se/api-update-blog/changes-in-the-api-portal">så är inte längre fallet</a> men en kopia från 2019 finns sparad i <code>systembolaget_2019-10-30.csv</code>. Ladda ner den med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/systembolaget_2019-10-30.csv&quot;,
              &quot;data/systembolaget_2019-10-30.csv&quot;)</code></pre>
<p>och läs in med</p>
<pre class="r"><code>bolaget &lt;- read_csv(&quot;data/systembolaget_2019-10-30.csv&quot;)</code></pre>
<p>skapa dig en överblick genom att använda t.ex. <code>glimpse</code> eller <code>View</code>. Ett enkelt sätt att få en överblick över en viss kategorisk variabel (om kategorierna inte är för många) är ett stapeldiagram med <code>geom_bar</code>, prova till exempel med variablerna <code>Varugrupp</code> eller <code>Ursprungsland</code>. Man kan koppla den kategoriska variabeln antingen till y eller x-axeln (med <code>aes(x = Varugrupp)</code> respektive <code>aes(y = Varugrupp)</code>). Vilket passar bäst?</p>
<p>Vilken varugrupp har högst literpris? Gör ett punktdiagram med <code>Varugrupp</code> på <code>y</code>-axeln och <code>PrisPerLiter</code> på <code>x</code>-axeln. Eftersom fördelningen för <code>PrisPerLiter</code> kan det öka läsbarheten att använda en logaritmisk skala på <code>x</code>-axeln genom att lägga till <code>+ scale_x_log10()</code> till anropet. Som med veckodagarna ovan är det inte optimalt att ordna kategorierna alfabetiskt, prova att använda <code>y = fct_reorder(Varugrupp, PrisPerLiter)</code> istället för <code>y = Varugrupp</code>. Funktionen <code>fct_reorder</code> gör om <code>Varugrupp</code> till faktorvariabel och ordnar kategorierna efter <code>PrisPerLiter</code> (medianen i varje grupp).</p>
<p>Med hjälp av <code>filter</code> kan vi begränsa oss till vissa kategorier (mer om detta nästa vecka). Vad genererar till exempel följande kod?</p>
<pre class="r"><code>bolaget_subdata &lt;- filter(bolaget, 
                      Ursprunglandnamn %in% c(&quot;Sverige&quot;, &quot;Storbritannien&quot;, &quot;Frankrike&quot;, &quot;Spanien&quot;), 
                      Varugrupp %in% c(&quot;Öl&quot;, &quot;Rött vin&quot;, &quot;Whisky&quot;, &quot;Aperitif och dessert&quot;))
ggplot(data = bolaget_subdata,
       mapping = aes(y = Ursprunglandnamn)) + 
  geom_bar() + 
  facet_wrap(~Varugrupp, scales = &quot;free_x&quot;)</code></pre>
</div>
<div id="gapminder-data" class="section level4">
<h4>Gapminder data</h4>
<p><a href="https://www.gapminder.org/">Gapminder foundation</a> verkar för att förändra människors syn på världen med data. Titta gärna på något av <a href="https://www.ted.com/speakers/hans_rosling?language=sv">Hans Roslings föredrag</a> eller använd deras <a href="https://www.gapminder.org/tools/#$chart-type=bubbles&amp;url=v1">interaktiva verktyg</a> och försök återskapa figurerna med <code>ggplot</code>. En begränsad del av deras data har sammanställts i <code>gapminder_2021-06-14.csv</code> (se <a href="https://www.gapminder.org/data/documentation/">dokumentation</a>). Ladda ner med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/gapminder_2021-06-14.csv&quot;,
              &quot;data/gapminder_2021-06-14.csv&quot;)</code></pre>
<p>och läs in med</p>
<pre class="r"><code>gapminder &lt;- read_csv(&quot;data/gapminder_2021-06-14.csv&quot;)</code></pre>
<hr />
</div>
</div>
</div>
<div id="v25-sammanfatta-en-tabell" class="section level2">
<h2><strong>v25</strong>: Sammanfatta en tabell</h2>
<div id="mål-denna-vecka-2" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Att kunna sortera och filtrera med <code>arrange</code> och <code>filter</code>.</li>
<li>Skapa nya kolumner med <code>mutate</code></li>
<li>Sammanställningar med <code>group_by</code> och <code>summarise</code></li>
</ul>
</div>
<div id="kursmaterial-2" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>R4DS: <a href="https://r4ds.had.co.nz/transform.html">Kapitel 5-6</a>.</li>
</ul>
<p>RStudio Primers:</p>
<ul>
<li><a href="https://rstudio.cloud/learn/primers/2.2">Isolating data with dplyr</a></li>
<li><a href="https://rstudio.cloud/learn/primers/2.3">Deriving information with dplyr</a></li>
</ul>
</div>
<div id="övningar-1" class="section level3">
<h3>Övningar</h3>
<div id="ettor-på-stan-1" class="section level4">
<h4>Ettor på stan</h4>
<ul>
<li><p>Använd <code>arrange</code> (eventuellt i kombination med <code>select</code> för att begränsa utskriften) för att verifiera att bostaden med äldst <code>constructionYear</code> ligger i vad som troligen är <a href="https://sv.wikipedia.org/wiki/Baggensgatan_27">Stockholms äldsta bevarande bostadshus</a>. För flera rader antar <code>constructionYear</code> värdet <code>NA</code>, värde saknas. Hur hanteras detta av <code>arrange</code>?</p></li>
<li><p>Använd <code>count</code> och <code>arrange</code> för att hitta den gatuadress där det sålts flest ettor. Detta är <a href="https://stockholmskallan.stockholm.se/post/32632">Kvinnornas hus</a> som huvudsakligen består av ettor med kokvrå.</p></li>
<li><p>Inför variabeln <code>priceRise</code> som prisökningen i procent (baserat på <code>soldPrice</code> och <code>listPrice</code>) och bestäm medelvärdet av <code>priceRise</code> per mäklare (<code>source.name</code>) för alla mäklare med minst 100 försäljningar och sammanfatta med ett histogram. <strong>OBS</strong>: Hur hanterar funktionen <code>mean</code> saknade värden? En försäljning i materialet sticker ut, kan du hitta och filtrera bort den?</p></li>
</ul>
</div>
<div id="gapminder-data-1" class="section level4">
<h4>Gapminder data</h4>
<ul>
<li>Gör en tabell över medelinkomsten per capita för varje kontinent 2020 baserat på Gapminder data från förra veckans övningar. Tänk på att även <code>income</code> är räknat i per capita, du behöver alltså bestämma kontinenternas totala inkomst och dela på den totala populationen.</li>
</ul>
</div>
<div id="systembolagets-katalog-1" class="section level4">
<h4>Systembolagets katalog</h4>
<ul>
<li>Illustrera hur medelpriset per liter på Röda viner beror på årgång (du kan begränsa dig till årgångar med minst 10 produkter).</li>
<li>Illustrera hur medelpriset per liter på Röda viner beror på ursprungsland med ett stapeldiagram, ordna staplarna efter medelpris (du kan begränsa dig till länder med minst 10 produkter).</li>
<li>Kolumnen <code>Alkoholhalt</code> är kodad som textvariabel eftersom den innehåller ett procenttecken, gör om den till numerisk genom att först ta bort procenttecknet med <code>str_remove</code> och sedan konvertera med <code>as.numeric</code>. Illustrera sedan hur pris per liter beror på alkoholhalt för varugruppen öl i ett punktdiagram med en rät trendlinje (<code>geom_smooth(method = "lm")</code>).</li>
<li><a href="https://skatteverket.se/foretag/skatterochavdrag/punktskatter/alkoholskatt/skattesatser.4.4a47257e143e26725aecb5.html">Skattesatsen för öl</a> är 2.02 kronor per liter och volymprocent, bestäm en ny variabel <code>SkattPerLiter</code> som innehåller skattesatsen. Plotta sedan <code>PrisPerLiter - SkattPerLiter</code> mot <code>Alkoholhalt</code> (för varugruppen öl) med trendlinje.</li>
</ul>
</div>
<div id="badväder" class="section level4">
<h4>Badväder</h4>
<p>Hos Havs och Vattenmyndigheten kan du hitta <a href="https://havbipub.havochvatten.se/analytics/saw.dll?PortalPages&amp;PortalPath=%2Fshared%2FHemsidan%2FBadplats%2F_portal%2FBadplats">statistik över vattenprover</a> tagna vid badplatser runt om i landet, ett utdrag i Excel-format kan laddas ned med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/Provresultat.xlsx&quot;,
              &quot;data/Provresultat.xlsx&quot;)</code></pre>
<p>och läsas in med</p>
<pre class="r"><code>badvatten &lt;- readxl::read_excel(&quot;data/Provresultat.xlsx&quot;) %&gt;% 
  fill(Län, Kommun)</code></pre>
<p>Vad gör funktionen <code>fill</code> i detta fall? Undersök materialet närmare avseende t.ex. skillnader mellan län, EU-bad/Övriga och Badplatstyp. En svårighet är att man för E.coli och enterokocker ibland använder ett mätvärde och ibland en övre gräns (se prefix-kolumnerna).</p>
<p>Ovanstående utdrag hämtades i maj då det fortfarande var ganska kallt i vattnet. Vill du hämta aktuella data på samma format väljer du <em>Exportera &gt; Formaterad &gt; Excel</em> längst ned till vänster på sidan.</p>
<hr />
</div>
</div>
</div>
<div id="v26-utforska-data-med-visualiseringar" class="section level2">
<h2><strong>v26</strong>: Utforska data med visualiseringar</h2>
<div id="mål-denna-vecka-3" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Skriva en enkel rapport i Rmarkdown.</li>
<li>Utforska data med <code>ggplot</code>.</li>
<li>Andra laborationen inlämnad (deadline söndag).</li>
</ul>
</div>
<div id="kursmaterial-3" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>R4DS: <a href="https://r4ds.had.co.nz/exploratory-data-analysis.html">Kapitel 7</a>, <a href="https://r4ds.had.co.nz/r-markdown.html">Kapitel 27</a> och <a href="https://r4ds.had.co.nz/graphics-for-communication.html">Kapitel 28</a>.</li>
</ul>
<p>RStudio Primers:</p>
<ul>
<li><a href="https://rstudio.cloud/learn/primers/3">Visualize Data</a></li>
</ul>
</div>
<div id="övningar-2" class="section level3">
<h3>Övningar</h3>
<p>Inga speciella övningar denna vecka, experimetera med visualiseringar av data från tidigare veckor.</p>
</div>
</div>
<div id="v27-läsa-data-från-fil" class="section level2">
<h2><strong>v27</strong>: Läsa data från fil</h2>
<div id="mål-denna-vecka-4" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Att kunna importera tabeller från textfiler.</li>
</ul>
</div>
<div id="kursmaterial-4" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>R4DS: <a href="https://r4ds.had.co.nz/data-import.html">Kapitel 9-11</a>.</li>
</ul>
<div id="kapitel-11-från-ett-svenskt-perspektiv" class="section level4">
<h4>Kapitel 11 från ett svenskt perspektiv</h4>
<p>Paketet <code>readr</code> följer amerikansk standard om du inte ber det göra något annat, här listar vi några skillnader mellan svensk och amerikansk standard som kan vara bra att ha koll på.</p>
<div id="filformatet-.csv" class="section level5">
<h5>Filformatet <code>.csv</code></h5>
<p><code>csv</code> står för <em>comma separated values</em> och är ett av de vanligaste formaten för att spara tabeller i en textfil. I en <code>csv</code>-fil motsvarar varje rad en rad i tabellen (översta raden består ofta av kolumnrubriker) och kommatecken används för att separera kolumner. Filen med innehåll</p>
<pre><code>x, y
1, 2
3, 4</code></pre>
<p>motsvarar alltså tabellen</p>
<pre class="r"><code>readr::read_csv(
&quot;x, y
1, 2
3, 4&quot;)</code></pre>
<pre><code>## # A tibble: 2 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2
## 2     3     4</code></pre>
<p>Detta fungerar bra i engelskspråkiga länder där man använder punkt som decimaltecken. När man som i svensk standard använder kommatecken som decimaltecken används istället ofta semikolon som kolumnavgränsare. Så är till exempel fallet i Excel; om du har Excel med svenska nationella inställningar och väljer att spara en tabell i formatet <code>CSV (kommaavgränsad) *.csv</code> så sparas den i själva verket som en fil där kolumner avgränsas med semikolon. Försöker du sedan läsa in den med <code>read_csv</code> placeras alla värden i samma kolumn</p>
<pre class="r"><code>readr::read_csv(
&quot;x; y
1; 2
3; 4&quot;)</code></pre>
<pre><code>## # A tibble: 2 x 1
##   `x; y`
##   &lt;chr&gt; 
## 1 1; 2  
## 2 3; 4</code></pre>
<p>Eftersom detta är vanligt förekommande finns en specialfunktion <code>read_csv2</code> som utgår ifrån att kolumner skiljs med semikolon och komma används som decimaltecken</p>
<pre class="r"><code>readr::read_csv2(
&quot;x; y
1; 2
3; 4&quot;)</code></pre>
<pre><code>## # A tibble: 2 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2
## 2     3     4</code></pre>
</div>
<div id="decimaltecken-igen" class="section level5">
<h5>Decimaltecken igen</h5>
<p>När siffror kombineras med punkt, kommatecken och mellanslag gissar paketet <code>readr</code> vad dessa betyder utifrån amerikansk standard. Här kan det lätt bli fel om vi slarvar med att ange lokala inställningar (<code>locale</code>). Jämför till exempel</p>
<pre class="r"><code>readr::parse_number(c(&quot;3,14&quot;, &quot;3 000&quot;))</code></pre>
<pre><code>## [1] 314   3</code></pre>
<p>med</p>
<pre class="r"><code>readr::parse_number(c(&quot;3,14&quot;, &quot;3 000&quot;), locale = readr::locale(decimal_mark = &quot;,&quot;, 
                                                               grouping_mark = &quot; &quot;))</code></pre>
<pre><code>## [1]    3.14 3000.00</code></pre>
<p>Ibland får man lösa konverteringen själv. I data som matats in manuellt är det inte ovanligt att både punkt och kommatecken förekommer som decimaltecken om vartannat i samma fil. Då är det säkrare att läsa in alla kolumner som text (<code>chr</code>) och använda till exempel <code>str_replace(x, ",", ".")</code> följt av <code>as.numeric</code>.</p>
</div>
<div id="spagetti-med-kãttfãrssãs" class="section level5">
<h5>Spagetti med kÃ¶ttfÃ¤rssÃ¥s</h5>
<p>Antagligen har du någon gång stött på en text där svenska tecken bytts ut mot obegripliga symboler. Problemet beror på att det utvecklats många olika konventioner för <a href="https://sv.wikipedia.org/wiki/Teckenkod">teckenkodning</a> som kan vara specifika för operativsystem och applikationer. De viktigaste att känna till är <a href="https://sv.wikipedia.org/wiki/UTF-8">UTF-8</a>, som är standard på webben och kan koda alla möjliga språk, och <a href="https://sv.wikipedia.org/wiki/ISO/IEC_8859-1">ISO 8859-1</a> eller <strong>latin1</strong>, som är en enklare teckenkodning anpassad för västeropeiska språk. Paketet <code>readr</code> förutsätter alltid UTF-8, medan motsvarande funktioner i Rs <code>base</code>-paket (t.ex. <code>read.csv</code> som motsvarar <code>readr::read_csv</code>) anpassar sig efter lokala systeminställningar.</p>
<p>Ser ditt resutat ut som i rubriken har du antagligen försökt läsa in “köttfärssås” som latin1 när den i själva verket var kodad i UTF-8, detta är mindre vanligt med just <code>readr</code>-paketet eftersom det läser in som UTF-8 om du inte anger något annat. Om du däremot försöker läsa in en fil kodad i latin1 med <code>readr</code> blir det <code>k\xf6ttf\xe4rss\xe5s</code> om du inte anger <code>locale = locale(encoding = "latin1")</code>.</p>
</div>
</div>
</div>
<div id="övningar-3" class="section level3">
<h3>Övningar</h3>
<div id="scb-data" class="section level4">
<h4>SCB-data</h4>
<p>I <a href="https://www.statistikdatabasen.scb.se/pxweb/sv/ssd/">SCBs statistikdatabas</a> kan man skapa en länk (url) till tabeller man tagit fram. Filen på <code>https://www.statistikdatabasen.scb.se/sq/110431</code> innehåller medelålder per län i formatet <em>Kommaavgränsad med rubrik</em>. Undersök den med <code>read_lines("https://www.statistikdatabasen.scb.se/sq/110431")</code> och försök sedan läsa in den korrekt med <code>read_csv</code>.</p>
</div>
<div id="mer-badvatten" class="section level4">
<h4>Mer badvatten</h4>
<p>Badvattenfilen som användes i tidigare övningar var exporterad som Excel-fil från <a href="https://havbi.havochvatten.se/analytics/saw.dll?PortalPages">Hav och Vattenmyndigheten</a>, om vi istället väljer att exportera som csv får vi en fil som kan hämtas med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/Provresultat.csv&quot;,
              &quot;data/Provresultat.csv&quot;)</code></pre>
<p>Försök läsa in den med <code>read_csv</code>, vad händer med vattentemperaturen? Fixa!</p>
<hr />
</div>
</div>
</div>
<div id="v28-omforma-och-sammanfläta-tabeller" class="section level2">
<h2><strong>v28</strong>: Omforma och sammanfläta tabeller</h2>
<div id="mål-denna-vecka-5" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Att kunna omforma tabeller till ett “tidy”-format.</li>
<li>Att kunna skapa nya tabeller genom att sammanfoga flera tabeller med gemensamma kolumner.</li>
</ul>
</div>
<div id="kursmaterial-5" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>R4DS: <a href="https://r4ds.had.co.nz/tidy-data.html">Kapitel 12-13</a></li>
</ul>
<p>RStudio primers:</p>
<ul>
<li><a href="https://rstudio.cloud/learn/primers/4">Tidy your data</a>. <strong>OBS</strong>: I delen <em>Reshape Data</em> används funktionerna <code>gather</code> och <code>spread</code>, dessa har ersatts med <code>pivot_longer</code> och <code>pivot_wider</code> som är enklare att använda (de gamla fungerar dock fortfarande). Försök lösa övningen med <code>pivot_longer</code> och <code>pivot_wider</code>.</li>
</ul>
</div>
<div id="övningar-4" class="section level3">
<h3>Övningar</h3>
<div id="gapminder-data-2" class="section level4">
<h4>Gapminder data</h4>
<p>På <a href="https://www.gapminder.org/data/">gapminders dataarkiv</a> kan man ladda ner deras sammanställda datamaterial, en fil för varje variabel. Tabellen som använts i tidigare övningar är sammanställd av sådana filer. Filen med antal mobiltelefoner per land och år har vi hämtat så att den kan laddas ned med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/cell_phones_total_2021-06-27.csv&quot;,
              &quot;data/cell_phones_total_2021-06-27.csv&quot;)</code></pre>
<p>och sedan läsas in med</p>
<pre class="r"><code>cell_phones_total &lt;- read_csv(&quot;data/cell_phones_total_2021-06-27.csv&quot;,
                              col_types = cols(.default = &quot;c&quot;))</code></pre>
<p>här ser <code>col_types = cols(.default = "c" )</code> till att alla kolumner läses in som text (<code>chr</code>) vilket kommer visa sig vara praktiskt. Du kan också prova med någon anna variabel du hämtad ned direkt från gapminder.</p>
<p>Uppgiften är nu att lägga till variabeln till gapminder-tabellen från tidigare övningar genom att</p>
<ul>
<li>Gör om <code>cell_phones_total</code> till “tidy”-format med <code>pivot_longer</code>.</li>
<li>Lägg till den nya variabeln som en kolumn i gapminder tabellen med lämplig <code>*_join</code> (om du gör allt i en pipe-sekvens kan <code>right_join</code> vara lämpligt).</li>
<li>Anledningen till att vi läste in alla kolumner som text är att gapminder valt att koda numeriska värden i olika enheter. Talet 1100 kodas t.ex. som <code>1.1k</code> och 12 600 000 som <code>12.6M</code>. Detta kan t.ex. lösas med <code>case_when</code> som nedan</li>
</ul>
<pre class="r"><code>case_when(
  str_detect(antal_mobiler, &quot;k&quot;) ~ 1000 * (str_remove(antal_mobiler, &quot;k&quot;) %&gt;% as.numeric()),
  str_detect(antal_mobiler, &quot;M&quot;) ~ ...</code></pre>
</div>
<div id="jämställdhet" class="section level4">
<h4>Jämställdhet</h4>
<p>Tabellen</p>
<pre class="r"><code>read_csv(&quot;https://www.statistikdatabasen.scb.se/sq/110673&quot;, 
         skip = 1, locale = locale(encoding = &quot;latin1&quot;))</code></pre>
<pre><code>## # A tibble: 2 x 8
##   kön     `1995` `1999` `2004` `2009` `2011` `2014` `2019`
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 kvinnor      9      9     11     10      9     11     11
## 2 män         13     13      8      8     11      9      9</code></pre>
<p>innehåller antal svenska EU-parlamentariker efter kön och år. Använd <code>pivot_longer</code>, <code>pivot_wider</code>, <code>mutate</code> och <code>select</code> i en följd för att generera</p>
<pre><code>## # A tibble: 7 x 2
##   year  percent_female
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 1995            40.9
## 2 1999            40.9
## 3 2004            57.9
## 4 2009            55.6
## 5 2011            45  
## 6 2014            55  
## 7 2019            55</code></pre>
</div>
<div id="koroplet" class="section level4">
<h4>Koroplet</h4>
<p>Koropletkartor brukar användas när man vill visa hur en variabel varierar geografiskt, ofta med en indelning i områden som t.ex. län eller kommuner. Du kan ladda ner och packa upp en karta över sveriges län i som en så kallad shapefil (<a href="https://www.scb.se/hitta-statistik/regional-statistik-och-kartor/regionala-indelningar/digitala-granser/">hämtad från SCB</a>) med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/LanSweref99TM.zip&quot;,
              &quot;LanSweref99TM.zip&quot;)
unzip(&quot;LanSweref99TM.zip&quot;, exdir = &quot;LanSweref99TM&quot;)</code></pre>
<p>Paketet <code>sf</code> innehåller funktioner för att arbeta med geografiska data och kan bland annat läsa in en shapefil i tabellformat med <code>st_read</code> som sedan kan plottas med <code>geom_sf</code></p>
<pre class="r"><code>library(sf)
karta_lan &lt;- st_read(&quot;LanSweref99TM/Lan_Sweref99TM_region.shp&quot;, quiet = TRUE)
ggplot(karta_lan, aes(fill = LnNamn)) + geom_sf()</code></pre>
<p><img src="https://raw.githubusercontent.com/MT3003-ST22/mt3003-st22.github.io/main/img/lan.png" width="50%" /></p>
<p>Objektet <code>karta_lan</code> kan användas som en vanlig tabell/<code>tibble</code>. Det betyder att vi kan lägga till länsvisa variabler med <code>*_join</code> om vi vill färglägga efter något mer intressant än <code>LnNamn</code>. Prova tabellen med medelålder från tidigare övningar, en nyckel får du t.ex. genom att skapa en variabel <code>LnKod = str_sub(region, 1, 2)</code> i tabellen över medelålder.</p>
<p>Ett alternativ till <code>ggplot</code> för just kartframställning är paketet <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html"><code>tmap</code></a> som kan vara enklare att använda men mindre flexibelt.</p>
<hr />
</div>
</div>
</div>
<div id="v29-arbeta-med-text-faktorer-och-datum." class="section level2">
<h2><strong>v29</strong>: Arbeta med text, faktorer och datum.</h2>
<div id="mål-denna-vecka-6" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Att kunna använda verktyg i paketen <code>stringr</code>, <code>forcats</code> och <code>lubridate</code>.</li>
</ul>
</div>
<div id="kursmaterial-6" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>R4DS: <a href="https://r4ds.had.co.nz/strings.html">Kapitel 14-16</a> (14.3 om reguljära uttryck kan läsas kursivt, ni förväntas ha en grundläggande förståelse för konceptet men inte detaljerna).</li>
</ul>
</div>
<div id="övningar-5" class="section level3">
<h3>Övningar</h3>
<p>Kapitel 14-16 innehåller specifika verktyg för att arbeta med text, faktorer och datum. Vi har redan stött på flera av dessa, t.ex. förekom <code>stringr::str_detect</code>, <code>forcats::fct_relevel</code> och <code>lubridate::yday</code> i Laboration 2. Funktionerna i <code>stringr</code> och <code>forcats</code> börjar alltid med <code>str_</code> respective <code>fct_</code> vilket gör det enkelt att leta efter dem i RStudios Console-fönster då man får upp en lista genom att inleda raden med dessa tecken (skriv <code>lubridate::</code> för motsvarande lista för detta paket). Specifika övningar ges i kursboken, här ger vi ett exempel på hur man kan arbeta med textdata.</p>
<div id="en-textanalys" class="section level4">
<h4>En textanalys</h4>
<p>På <a href="https://www.gutenberg.org/">Projekt Gutenberg</a> finns en stor samling gratis e-böcker. Vi kan ladda ner Strindbergs Hemsöborna med</p>
<pre class="r"><code>download.file(&quot;https://www.gutenberg.org/cache/epub/30078/pg30078.txt&quot;,
              &quot;data/hemsoborna.txt&quot;)</code></pre>
<p>läsa ett valt stycke med</p>
<pre class="r"><code>read_lines(&quot;data/hemsoborna.txt&quot;, skip = 194, n_max = 21) %&gt;% 
  str_c(collapse = &quot; &quot;)</code></pre>
<pre><code>## [1] &quot;Han kom som ett yrväder en aprilafton och hade ett höganäskrus i en  \nsvångrem om halsen. Clara och Lotten voro inne med sköt-ekan att hämta  \nhonom på Dalarö brygga; men det dröjde evigheter, innan de kommo i båt.  \nDe skulle till handelsman och ha en tunna tjära och på abeteket och hämta  \ngråsalva åt grisen, och så skulle de på posten och få ett frimärke, och  \nså skulle de ner till Fia Lövström i Kroken och låna tuppen mot ett  \nhalvpund småtärna till notbygget, och sist hade de hamnat på  \ngästgivaregården, där Carlsson bjudit på kaffe med dopp. Och så kommo de  \näntligen i båt, men Carlsson ville styra, och det kunde han inte, för han  \nhade aldrig sett en råseglare förr, och därför skrek han, att de skulle  \nhissa focken, som inte fanns.&quot;</code></pre>
<p>och spara hela boken i en tibble med</p>
<pre class="r"><code>hemsoborna &lt;- tibble(row = read_lines(&quot;data/hemsoborna.txt&quot;, 
                                       skip = 90, n_max = 10178)) %&gt;% 
  filter(row != &quot;&quot;) %&gt;% 
  mutate(row_no = 1:n())
hemsoborna</code></pre>
<pre><code>## # A tibble: 5,088 x 2
##    row                   row_no
##    &lt;chr&gt;                  &lt;int&gt;
##  1 &quot;\n&quot;                       1
##  2 &quot;\n&quot;                       2
##  3 &quot;\n&quot;                       3
##  4 &quot;\nHEMSÖBORNA&quot;             4
##  5 &quot;\n&quot;                       5
##  6 &quot;\nAV&quot;                     6
##  7 &quot;\n&quot;                       7
##  8 &quot;\nAUGUST STRINDBERG&quot;      8
##  9 &quot;\n&quot;                       9
## 10 &quot;\nSTOCKHOLM&quot;             10
## # ... with 5,078 more rows</code></pre>
<p>här har vi klippt bort text som inte hör till boken med <code>skip</code> och <code>n_max</code>, tagit bort tomma rader och lagt till radnummer. För att analysera texten vidare delar vi upp den ord för ord, konverterar bokstäver till gemener och lägger in en räknare för kapitel</p>
<pre class="r"><code>hemsoborna_words &lt;- hemsoborna %&gt;% 
  mutate(word = str_extract_all(row, boundary(&quot;word&quot;))) %&gt;% 
  group_by(row_no) %&gt;% 
  summarise(word = unlist(word)) %&gt;% 
  ungroup() %&gt;% 
  mutate(word = str_to_lower(word),
         chapter = cumsum(str_detect(word, &quot;kapitlet&quot;)))</code></pre>
<ul>
<li>Vad gör egentligen <code>chapter = cumsum(str_detect(word, "kapitlet"))</code>?</li>
</ul>
<p>Vi kan nu få de vanligaste orden med</p>
<pre class="r"><code>hemsoborna_words %&gt;% count(word, sort = TRUE)</code></pre>
<pre><code>## # A tibble: 8,481 x 2
##    word      n
##    &lt;chr&gt; &lt;int&gt;
##  1 och    2457
##  2 i      1053
##  3 han     940
##  4 att     875
##  5 på      851
##  6 som     811
##  7 det     797
##  8 en      756
##  9 med     571
## 10 sig     509
## # ... with 8,471 more rows</code></pre>
<p>de flesta av dessa är så kallade stoppord, ord som är viktiga för att binda ihop texten men annars betydelsefattiga. För att ta bort dem hämtar vi en lista på svenska stoppord</p>
<pre class="r"><code>stopwords &lt;- read_table(&quot;https://raw.githubusercontent.com/stopwords-iso/stopwords-sv/master/stopwords-sv.txt&quot;,
           col_names = &quot;word&quot;)</code></pre>
<ul>
<li>Använd <code>anti_join</code> för att ta bort alla stoppord från listan på de vanligaste orden.</li>
<li>Illustrera resultatet med funktionen <code>wordcloud2::wordcloud2</code>.</li>
</ul>
<p>Stämningsanalys (semtiment analysis) är en populär metod för att beskriva känslostämningar i texter (se till exempel <a href="https://juliasilge.com/blog/if-i-loved-nlp-less/">Jane Austen</a> och <a href="http://varianceexplained.org/r/trump-tweets/">Donald Trump</a>). I allmänhet bygger det på att man anväder ett lexikon som kvantifierar stämningen i enskilda ord, till exempel associerar ett posotivt numeriskt värde till “kärlek” och ett negativt till “svartsjuka”. Ett svenskt sådant lexikon kan laddas ned från <a href="https://spraakbanken.gu.se/">språkbanken</a> som</p>
<pre class="r"><code>sentiment_lex &lt;- read_csv(&quot;https://svn.spraakdata.gu.se/sb-arkiv/pub/lmf/sentimentlex/sentimentlex.csv&quot;)</code></pre>
<ul>
<li>Koppla ihop <code>hemsoborna_words</code> och <code>sentiment_lex</code> med en <code>inner_join</code> och illustrera hur det går utför för Carlsson genom att bestämma medelvärdet av känslostämningen (variabeln <code>strength</code>) för varje kapitel.</li>
</ul>
<hr />
</div>
</div>
</div>
<div id="v30-funktioner-och-iteration" class="section level2">
<h2><strong>v30</strong>: Funktioner och iteration</h2>
<div id="mål-denna-vecka-7" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Att kunna skriva enkla funktioner för att göra koden mer lättläst och enklare att underhålla.</li>
<li>Att kunna arbeta med Rs list-format.</li>
<li>Att kunna förenkla upprepade uppgifter med iteration.</li>
</ul>
</div>
<div id="kursmaterial-7" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>R4DS: <a href="https://r4ds.had.co.nz/program-intro.html">Kapitel 17-21</a></li>
</ul>
</div>
<div id="övningar-6" class="section level3">
<h3>Övningar</h3>
<div id="booli-figurer" class="section level4">
<h4>Booli figurer</h4>
<p>Koden bakom en figur skapad med <code>ggplot</code> kan bli många rader om man vill finjustera detaljer. Skall man upprepa en figur för olika parametervärden är det därför praktiskt att skriva en funktion. Använd tabellen över 20000 försäljningar i innerstaden som laddas ned med</p>
<pre class="r"><code>download.file(&quot;https://github.com/MT3003-ST22/data/raw/main/booli_alla_2022-05-24.csv&quot;,
              &quot;data/booli_alla_2022-05-24.csv&quot;)
booli_data &lt;- read_csv(&quot;data/booli_alla_2022-05-24.csv&quot;)</code></pre>
<ul>
<li>Konstruera en funktion</li>
</ul>
<pre class="r"><code>plot_price_ts &lt;- function(data, title = &quot;Pris per kvadratmeter i Stockholms innerstad&quot;){
  ...
}</code></pre>
<p>som skapar en figur motsvarande den i Laboration 1 baserat på givet <code>data</code>.</p>
<ul>
<li>Vill vi nu plotta t.ex. tvåor kan vi använda funktionen med anropet <code>booli_data %&gt;% filter(rooms == 2) %&gt;% plot_price_ts()</code>. Lägg till ett argument <code>rooms</code> till funktionen så att <code>plot_price_ts(booli_data, rooms = 2)</code> ger samma resultat.</li>
</ul>
</div>
<div id="olympiska-medaljer" class="section level4">
<h4>Olympiska medaljer</h4>
<p>På <a href="https://sv.wikipedia.org/wiki/Medaljf%C3%B6rdelning_vid_olympiska_sommarspelen_2020">https://sv.wikipedia.org/wiki/Medaljf%C3%B6rdelning_vid_olympiska_sommarspelen_2020</a> hittar du medaljfördelningen för OS i Tokyo. Tabellen kan hämtas med</p>
<pre class="r"><code>library(rvest)
url &lt;- &quot;https://sv.wikipedia.org/wiki/Medaljf%C3%B6rdelning_vid_olympiska_sommarspelen_2020&quot;
read_html(url) %&gt;% 
  html_element(&quot;.wikitable&quot;) %&gt;% 
  html_table()</code></pre>
<pre><code>## # A tibble: 94 x 7
##    Pl.   Land            Guld Silver Brons TAM    PEAM
##    &lt;chr&gt; &lt;chr&gt;          &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;
##  1 1     USA               39     41    33 113       1
##  2 2     Kina              38     32    18 88        2
##  3 3     Japan             27     14    17 58        5
##  4 4     Storbritannien    22     21    22 65        4
##  5 5     ROC               20     28    23 71        3
##  6 6     Australien        17      7    22 46        6
##  7 7     Nederländerna     10     12    14 36        9
##  8 8     Frankrike         10     12    11 33       10
##  9 9     Tyskland          10     11    16 37        8
## 10 10    Italien           10     10    20 40        7
## # ... with 84 more rows</code></pre>
<p>En motsvarande tabell för t.ex. OS i Rio kan hämtas genom att byta <code>2020</code> mot <code>2016</code>.</p>
<p>Konstruera en funktion</p>
<pre class="r"><code>get_medals &lt;- function(year){
  ...
}</code></pre>
<p>som returnerar medaljtabellen för OS-år <code>year</code> som nedan (glöm inte ta bort Total-raden). Tyvärr är inte alla kolumnnamn helt konsistenta, men du behöver bara kolumnerna <code>Land</code>, <code>Guld</code>, <code>Silver</code> och <code>Brons</code>.</p>
<pre class="r"><code>get_medals(2016)</code></pre>
<pre><code>## # A tibble: 264 x 4
##     year country        class  number
##    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;   &lt;int&gt;
##  1  2016 USA            Guld       46
##  2  2016 USA            Silver     37
##  3  2016 USA            Brons      38
##  4  2016 Storbritannien Guld       27
##  5  2016 Storbritannien Silver     23
##  6  2016 Storbritannien Brons      17
##  7  2016 Kina           Guld       26
##  8  2016 Kina           Silver     18
##  9  2016 Kina           Brons      26
## 10  2016 Ryssland       Guld       19
## # ... with 254 more rows</code></pre>
<ul>
<li>Använd <code>map_df</code> med <code>seq(1948, 2020, by = 4)</code> och <code>get_medals</code> som argument för att skapa en tabell över medaljfördelningen för alla sommar OS sedan 1948.</li>
</ul>
</div>
<div id="gapminder-data-3" class="section level4">
<h4>Gapminder data</h4>
<p>I en <a href="https://mt3003-st22.github.io/schedule.html#v28:_Omforma_och_sammanfl%C3%A4ta_tabeller">tidigare övning</a> omformade vi en csv-fil från gapminder till ett mer användbart format. Nedanstående kod hämtar fler filer och placerar dem i <code>data/gapminder_raw</code></p>
<pre class="r"><code>dir.create(&quot;data/gapminder_raw&quot;)
filenames &lt;- c(&quot;cell_phones_total.csv&quot;, &quot;child_mortality_0_5_year_olds_dying_per_1000_born.csv&quot;, 
               &quot;children_per_woman_total_fertility.csv&quot;, &quot;co2_emissions_tonnes_per_person.csv&quot;, 
               &quot;income_per_person_gdppercapita_ppp_inflation_adjusted.csv&quot;, 
               &quot;life_expectancy_years.csv&quot;, &quot;population_total.csv&quot;)

urls &lt;- str_c(&quot;https://github.com/MT3003-ST22/data/raw/main/gapminder_raw/&quot;, filenames)
destfiles &lt;- str_c(&quot;data/gapminder_raw/&quot;, filenames)
walk2(urls, destfiles, download.file)</code></pre>
<ul>
<li>Konstruera en funktion</li>
</ul>
<pre class="r"><code>read_gapminder &lt;- function(file, path = &quot;data/gapminder_raw/&quot;){
  ...
}</code></pre>
<p>som genererar följande</p>
<pre class="r"><code>read_gapminder(&quot;life_expectancy_years.csv&quot;)</code></pre>
<pre><code>## # A tibble: 56,889 x 4
##    country     year  value variable             
##    &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                
##  1 Afghanistan 1800   28.2 life_expectancy_years
##  2 Afghanistan 1801   28.2 life_expectancy_years
##  3 Afghanistan 1802   28.2 life_expectancy_years
##  4 Afghanistan 1803   28.2 life_expectancy_years
##  5 Afghanistan 1804   28.2 life_expectancy_years
##  6 Afghanistan 1805   28.2 life_expectancy_years
##  7 Afghanistan 1806   28.1 life_expectancy_years
##  8 Afghanistan 1807   28.1 life_expectancy_years
##  9 Afghanistan 1808   28.1 life_expectancy_years
## 10 Afghanistan 1809   28.1 life_expectancy_years
## # ... with 56,879 more rows</code></pre>
<p>här kan du ge kolumnen <code>variable</code> värdet <code>str_sub(file, 1, -5)</code>.</p>
<ul>
<li>Skapa en tabell (samma fyra kolumner) med alla variabler genom att använda <code>map_df</code> med argument <code>list.files("data/gapminder_raw/")</code> och <code>read_gapminder</code>.</li>
</ul>
<hr />
</div>
</div>
</div>
<div id="v31-apier-databaser-och-webbskrap" class="section level2">
<h2><strong>v31</strong>: APIer, databaser och webbskrap</h2>
<div id="mål-denna-vecka-8" class="section level3">
<h3>Mål denna vecka</h3>
<ul>
<li>Använda grundläggande funktioner i paket som <code>httr</code>, <code>dbplyr</code> och <code>rvest</code>.</li>
</ul>
</div>
<div id="kursmaterial-8" class="section level3">
<h3>Kursmaterial</h3>
<div id="kommunicera-med-ett-web-api" class="section level4">
<h4>Kommunicera med ett web-API</h4>
<p>Ett vanligt sätt att kommunicera med en databas är via ett så kallat <a href="https://sv.wikipedia.org/wiki/Representational_State_Transfer">REST API</a>, där anrop sker genom en webbadress (url). För populära API finns i allmänhet färdiga paket som förenklar kommunikationen, som t.ex. <a href="https://cran.r-project.org/web/packages/rtweet/">rtweet</a>, <a href="https://cran.r-project.org/web/packages/spotifyr/index.html">spotifyr</a> och <a href="https://cran.r-project.org/web/packages/rgbif/index.html">rgbif</a>. Saknas sådant kan man använta paketet <code>httr</code> för att själv konstruera anrop, vi kommer använda funktionerna <code>GET</code> och <code>content</code> från detta paket.</p>
<div id="a-pi" class="section level5">
<h5>A-<span class="math inline">\(\pi\)</span></h5>
<p><a href="https://pi.delivery/#apipi_get">A-<span class="math inline">\(\pi\)</span></a> är ett enkelt API där du kan hämta en sekvens av <span class="math inline">\(\pi\)</span>:s decimaler. Du behöver ange en startposition (<code>start</code>) och antal siffror (<code>numberOfDigits</code>), första 10 decimalerna ges av anropet <a href="https://api.pi.delivery/v1/pi?start=1&amp;numberOfDigits=10"><code>https://api.pi.delivery/v1/pi?start=1&amp;numberOfDigits=10</code></a> som vi gör från R med</p>
<pre class="r"><code>library(httr)
response &lt;- GET(&quot;https://api.pi.delivery/v1/pi?start=1&amp;numberOfDigits=10&quot;)
content(response)</code></pre>
<pre><code>## $content
## [1] &quot;1415926535&quot;</code></pre>
</div>
<div id="nobel-api" class="section level5">
<h5>Nobel API</h5>
<p>På <a href="https://nobelprize.readme.io/">https://nobelprize.readme.io/</a> finns ett API där du kan hämta data om nobelpriser och pristagare. Välj en kategori, t.ex. <a href="https://nobelprize.readme.io/docs/prize">prize</a> och prova göra ett anrop under “Try it out” längst ned på sidan. Klicka “Try it!” och notera den URL som genereras i fönstret under. Väljer vi format <code>csv</code> och category <code>literature</code> blir denna <code>http://api.nobelprize.org/v1/prize.csv?category=literature</code>. För att hämta resultatet till R</p>
<pre class="r"><code>response &lt;- GET(&quot;http://api.nobelprize.org/v1/prize.csv?category=literature&quot;)
content(response)</code></pre>
<pre><code>## # A tibble: 118 x 8
##     year category   overallMotivation    id firstname  surname  motivation share
##    &lt;dbl&gt; &lt;chr&gt;      &lt;lgl&gt;             &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
##  1  2021 literature NA                 1004 Abdulrazak Gurnah   &quot;\&quot;for hi~     1
##  2  2020 literature NA                  993 Louise     Glück    &quot;\&quot;for he~     1
##  3  2019 literature NA                  980 Peter      Handke   &quot;\&quot;for an~     1
##  4  2018 literature NA                  979 Olga       Tokarcz~ &quot;\&quot;for a ~     1
##  5  2017 literature NA                  947 Kazuo      Ishiguro &quot;\&quot;who in~     1
##  6  2016 literature NA                  937 Bob        Dylan    &quot;\&quot;for ha~     1
##  7  2015 literature NA                  924 Svetlana   Alexiev~ &quot;\&quot;for he~     1
##  8  2014 literature NA                  912 Patrick    Modiano  &quot;\&quot;for th~     1
##  9  2013 literature NA                  892 Alice      Munro    &quot;\&quot;master~     1
## 10  2012 literature NA                  880 Mo         Yan      &quot;\&quot;who wi~     1
## # ... with 108 more rows</code></pre>
</div>
</div>
<div id="skrapa-webbsidor" class="section level4">
<h4>Skrapa webbsidor</h4>
<p>Ibland saknas ett öppet API och vi blir tvungna att skrapa tabeller direkt från en webbsidas html-kod. Ett exempel gavs i föregående veckas uppgifter där vi hämtade tabeller över OS-medaljer från Wikipedia. För att lyckas med detta behövs grundläggande förståelse för hur html-koden är uppbyggd med <a href="https://sv.wikipedia.org/wiki/HTML-element"><em>taggar</em> och <em>element</em></a>. Ett element består av en starttagg med eventuella attribut, innehåll och en sluttagg kodat som <code>&lt;tagg attributnamn="värde"&gt;Innehåll&lt;/tagg&gt;</code>. Informationen vi är ute efter är oftast <code>Innehåll</code> (men ibland <code>värde</code>).</p>
<p>Paketet <code>rvest</code> innehåller funktioner för att läsa webbsidor och extrahera information, vi illustrerar med ett minimalt exempel där vi vill få ut innehållet i taggen <code>b</code> ur <code>&lt;a&gt; 1 &lt;/a&gt; &lt;b&gt; 2 &lt;/b&gt;</code>. Först läser vi in html-koden</p>
<pre class="r"><code>page &lt;- read_html(&quot;&lt;a&gt; 1 &lt;/a&gt; &lt;b&gt; 2 &lt;/b&gt;&quot;)
page</code></pre>
<pre><code>## {html_document}
## &lt;html&gt;
## [1] &lt;body&gt;\n&lt;a&gt; 1 &lt;/a&gt; &lt;b&gt; 2 &lt;/b&gt;\n&lt;/body&gt;</code></pre>
<p>sedan extraherar vi taggen <code>b</code> med en så kallad <a href="https://www.w3schools.com/cssref/css_selectors.asp">CSS-väljare</a></p>
<pre class="r"><code>elements &lt;- html_elements(page, css = &quot;b&quot;)
elements</code></pre>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;b&gt; 2 &lt;/b&gt;</code></pre>
<p>slutligen drar vi ut innehållet som text</p>
<pre class="r"><code>html_text(elements)</code></pre>
<pre><code>## [1] &quot; 2 &quot;</code></pre>
<p>Svårigheten ligger i allmänhet att hitta en CSS-väljare som plockar ut precis vad vi vill ha. I övningen med OS-medaljer vill vi extrahera en specifik tabell från en Wikipedia-sida. En tabell i standardformat skrivs i html med start- och sluttagg <code>&lt;table&gt; ... &lt;/table&gt;</code>, vi kan därför prova med <code>css = "table"</code></p>
<pre class="r"><code>url &lt;- &quot;https://sv.wikipedia.org/wiki/Medaljf%C3%B6rdelning_vid_olympiska_sommarspelen_2020&quot;
page &lt;- read_html(url)
elements &lt;- html_elements(page, css = &quot;table&quot;)
elements</code></pre>
<pre><code>## {xml_nodeset (5)}
## [1] &lt;table class=&quot;wikitable sortable&quot;&gt;&lt;tbody&gt;\n&lt;tr&gt;\n&lt;th&gt;\n&lt;span style=&quot;curso ...
## [2] &lt;table class=&quot;navbox&quot; style=&quot;border-spacing:0; ;&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style=&quot;p ...
## [3] &lt;table class=&quot;collapsible autocollapse&quot; style=&quot;width:100%;border-spacing: ...
## [4] &lt;table class=&quot;navbox&quot; style=&quot;border-spacing:0; ;&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style=&quot;p ...
## [5] &lt;table class=&quot;collapsible autocollapse&quot; style=&quot;width:100%;border-spacing: ...</code></pre>
<p>Sidan innehåller fem tabeller där vi vill ha den första. Vi kan extrahera denna med</p>
<pre class="r"><code>html_table(elements[[1]])</code></pre>
<pre><code>## # A tibble: 94 x 7
##    Pl.   Land            Guld Silver Brons TAM    PEAM
##    &lt;chr&gt; &lt;chr&gt;          &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;
##  1 1     USA               39     41    33 113       1
##  2 2     Kina              38     32    18 88        2
##  3 3     Japan             27     14    17 58        5
##  4 4     Storbritannien    22     21    22 65        4
##  5 5     ROC               20     28    23 71        3
##  6 6     Australien        17      7    22 46        6
##  7 7     Nederländerna     10     12    14 36        9
##  8 8     Frankrike         10     12    11 33       10
##  9 9     Tyskland          10     11    16 37        8
## 10 10    Italien           10     10    20 40        7
## # ... with 84 more rows</code></pre>
<p>men väljer istället att utnyttja <code>class</code>-attributet <code>wikitable</code> eftersom medaljtabellen inte ligger först på alla OS-sidor</p>
<pre class="r"><code>elements &lt;- html_elements(page, css = &quot;.wikitable&quot;)
html_table(elements)</code></pre>
<pre><code>## [[1]]
## # A tibble: 94 x 7
##    Pl.   Land            Guld Silver Brons TAM    PEAM
##    &lt;chr&gt; &lt;chr&gt;          &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;
##  1 1     USA               39     41    33 113       1
##  2 2     Kina              38     32    18 88        2
##  3 3     Japan             27     14    17 58        5
##  4 4     Storbritannien    22     21    22 65        4
##  5 5     ROC               20     28    23 71        3
##  6 6     Australien        17      7    22 46        6
##  7 7     Nederländerna     10     12    14 36        9
##  8 8     Frankrike         10     12    11 33       10
##  9 9     Tyskland          10     11    16 37        8
## 10 10    Italien           10     10    20 40        7
## # ... with 84 more rows</code></pre>
<p>Punkten i <code>.wikitable</code> anger att det just är <code>class</code>-attributet vi skall välja efter (se <a href="https://www.w3schools.com/cssref/css_selectors.asp">CSS-väljare</a>). Ett verktyg som är användbart för att identifiera dessa är <a href="https://selectorgadget.com/">SelectorGadget</a>, som till exempel kan installeras som ett tillägg i Chrome.</p>
<p>På linande sätt kan vi hämta aktuell tabell för Allsvenskan med</p>
<pre class="r"><code>url &lt;- &quot;https://www.allsvenskan.se/tabell&quot;
page &lt;- read_html(url)
elements &lt;- html_elements(page, css = &quot;.col-md-6&quot;)
html_table(elements[[1]])</code></pre>
<pre><code>## # A tibble: 33 x 10
##    `#`   ``    LAG   ``             M     V     O     F     `+/-` P    
##    &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1 1     NA    &quot;&quot;    Hammarby       9     6     2     1     19-7  20   
##  2 2     NA    &quot;&quot;    BK Häcken      9     6     2     1     18-11 20   
##  3 3     NA    &quot;&quot;    AIK            10    6     2     2     15-12 20   
##  4 4     NA    &quot;&quot;    Djurgården     10    4     3     3     16-8  15   
##  5 5     NA    &quot;&quot;    Kalmar FF      9     5     0     4     12-8  15   
##  6 6     NA    &quot;&quot;    Malmö FF       10    4     3     3     9-9   15   
##  7 7     NA    &quot;&quot;    IF Elfsborg    9     4     2     3     17-9  14   
##  8 8     NA    &quot;&quot;    Mjällby AIF    9     4     2     3     9-8   14   
##  9 9     NA    &quot;&quot;    IK Sirius      9     4     2     3     9-13  14   
## 10 10    NA    &quot;&quot;    IFK Norrköping 9     4     1     4     12-10 13   
## # ... with 23 more rows</code></pre>
<p>där SelectorGadget har använts för att hitta väljaren <code>.col-md-6</code>. Notera att kolumnernas namn inte är fullständiga; tabellen är ju inte avsedd för skrapning och resultatet behöver därför ofta justeras. Vid webbskrapning är det viktigt att respektera att syftet i allmänhet inte är att dela data och därför inte belasta servrar i onödan. Upphovsrätten till data kan även vara skyddat genom <a href="https://lagen.nu/1960:729#P49">katalogskyddet</a>.</p>
</div>
<div id="kommunicera-med-en-sql-databas" class="section level4">
<h4>Kommunicera med en SQL-databas</h4>
<p><a href="https://sv.wikipedia.org/wiki/Structured_Query_Language">SQL</a> är det idag dominerande språket för att ställa frågor till relationsdatabaser. Syntax är lik den vi lärt oss från <code>tidyverse</code>s <code>dplyr</code>-paket och med den kunskapen är det inte svårt att lära sig ställa enkla frågor i SQL. Här kommer vi dock använda paketet <a href="https://dbplyr.tidyverse.org/"><code>dbplyr</code></a> som sköter översättningen till databasens språk.</p>
<p>Innan vi kan ställa frågor till en databas behöver vi skapa en anslutning med <code>DBI::dbConnect</code>. Vi ansluter här till en öppen exempeldatabas <code>imdb_small</code> som innehåller ett mindre utrag ur <a href="https://www.imdb.com/">IMDB</a> (se <a href="https://relational.fit.cvut.cz/">Relational Dataset Repository</a> för en lista på deras öppna databaser)</p>
<pre class="r"><code>con &lt;- DBI::dbConnect(
  RMariaDB::MariaDB(),
  host = &quot;relational.fit.cvut.cz&quot;,
  port = 3306,
  username = &quot;guest&quot;,
  password = &quot;relational&quot;,
  db = &quot;imdb_small&quot;
)</code></pre>
<p>Raden <code>RMariaDB::MariaDB()</code> anger hur vi skall ansluta, vilket beror på vilken mjukvara som driver databasen. I det här fallet är det en <a href="https://sv.wikipedia.org/wiki/MySQL">MySQL</a>-databas som stöds av R-paketet <code>RMariaDB</code> (se <a href="https://dbi.r-dbi.org/">DBI</a> för alternativ).</p>
<p>Vi kan nu lista databasens tabeller med</p>
<pre class="r"><code>DBI::dbListTables(con)</code></pre>
<pre><code>## [1] &quot;actors&quot;           &quot;directors&quot;        &quot;directors_genres&quot; &quot;movies&quot;          
## [5] &quot;movies_directors&quot; &quot;movies_genres&quot;    &quot;roles&quot;</code></pre>
<p>och skapa en <em>virtuell</em> kopia av tabellen <code>movies</code> med</p>
<pre class="r"><code>movies &lt;- tbl(con, &quot;movies&quot;)
movies</code></pre>
<pre><code>## # Source:   table&lt;movies&gt; [?? x 4]
## # Database: mysql [guest@relational.fit.cvut.cz:NA/imdb_small]
##        id name             year  rank
##     &lt;int&gt; &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt;
##  1  10920 Aliens           1986  8.20
##  2  17173 Animal House     1978  7.5 
##  3  18979 Apollo 13        1995  7.5 
##  4  30959 Batman Begins    2005 NA   
##  5  46169 Braveheart       1995  8.30
##  6 109093 Fargo            1996  8.20
##  7 111813 Few Good Men, A  1992  7.5 
##  8 112290 Fight Club       1999  8.5 
##  9 116907 Footloose        1984  5.80
## 10 124110 Garden State     2004  8.30
## # ... with more rows</code></pre>
<p>Här noterar vi att antalet rader i tabellen är listat som <code>??</code>, vilket beror på att <code>dbplyr</code> ser till att bara hämta så mycket som är nödvändigt för att visa tabellens inledande rader. Vill vi hämta hela tabellen som en vanlig <code>tibble</code> använder vi <code>collect</code></p>
<pre class="r"><code>collect(movies)</code></pre>
<pre><code>## # A tibble: 36 x 4
##        id name             year  rank
##     &lt;int&gt; &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt;
##  1  10920 Aliens           1986  8.20
##  2  17173 Animal House     1978  7.5 
##  3  18979 Apollo 13        1995  7.5 
##  4  30959 Batman Begins    2005 NA   
##  5  46169 Braveheart       1995  8.30
##  6 109093 Fargo            1996  8.20
##  7 111813 Few Good Men, A  1992  7.5 
##  8 112290 Fight Club       1999  8.5 
##  9 116907 Footloose        1984  5.80
## 10 124110 Garden State     2004  8.30
## # ... with 26 more rows</code></pre>
<p>Som ett exempel skapar vi en tabell över alla <code>Sci-Fi</code>-filmer i databasen med</p>
<pre class="r"><code>movies_genres &lt;- tbl(con, &quot;movies_genres&quot;)
movies_genres %&gt;% 
  filter(genre == &quot;Sci-Fi&quot;) %&gt;% 
  left_join(movies, by = c(&quot;movie_id&quot; = &quot;id&quot;)) %&gt;% 
  collect()</code></pre>
<pre><code>## # A tibble: 6 x 5
##   movie_id genre  name         year  rank
##      &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt;
## 1    10920 Sci-Fi Aliens       1986  8.20
## 2   147603 Sci-Fi Hollow Man   2000  5.30
## 3   207992 Sci-Fi Matrix, The  1999  8.5 
## 4   254943 Sci-Fi Pi           1998  7.5 
## 5   313459 Sci-Fi Star Wars    1977  8.80
## 6   350424 Sci-Fi Vanilla Sky  2001  6.90</code></pre>
<p>Vi kan även se den SQL-fråga som genererade resultatet med <code>show_query</code></p>
<pre class="r"><code>movies_genres %&gt;% 
  filter(genre == &quot;Sci-Fi&quot;) %&gt;% 
  left_join(movies, by = c(&quot;movie_id&quot; = &quot;id&quot;)) %&gt;% 
  show_query()</code></pre>
<pre><code>## &lt;SQL&gt;
## SELECT `movie_id`, `genre`, `name`, `year`, `rank`
## FROM (SELECT *
## FROM `movies_genres`
## WHERE (`genre` = &#39;Sci-Fi&#39;)) `LHS`
## LEFT JOIN `movies` AS `RHS`
## ON (`LHS`.`movie_id` = `RHS`.`id`)</code></pre>
<p>Slutligen avslutar vi med att stänga ned anslutningen för att inte belasta servern i onödan</p>
<pre class="r"><code>DBI::dbDisconnect(con)</code></pre>
<p>Sammanfattningsvis</p>
<ul>
<li>Anslut till databasen med <code>DBI::dbConnect</code>.</li>
<li>Lista tabeller med <code>DBI::dbListTables</code>.</li>
<li>Skapa virtuella tabeller med <code>tbl</code>.</li>
<li>Skriv din kod med virtuella tabelller och vanlig <code>tidyverse</code>-syntax.</li>
<li>Avsluta med <code>collect</code>.</li>
<li>Stäng anslutningen med <code>DBI::dbDisconnect</code>.</li>
</ul>
</div>
</div>
<div id="övningar-7" class="section level3">
<h3>Övningar</h3>
<div id="nobel-api-1" class="section level5">
<h5>Nobel API</h5>
<ul>
<li>Hämta alla pristagare (<a href="https://nobelprize.readme.io/docs/laureate">Laureate</a>) och bestäm andelen män i varje priskategori.</li>
</ul>
</div>
<div id="sr-api" class="section level5">
<h5>SR API</h5>
<p>Sveriges radio har ett <a href="https://sverigesradio.se/oppetapi">öppet API</a> där man bland annat kan hämta <a href="https://sverigesradio.se/api/documentation/v2/metoder/musik.html">låtlistor från en given kanal och datum</a>. Svaret ges dock inte i vanligt csv-format utan som <a href="https://sv.wikipedia.org/wiki/XML">XML</a> eller <a href="https://sv.wikipedia.org/wiki/JSON">JSON</a>, vilket är vanligt då dessa format är mer flexibla. Ofta är JSON enklare att arbeta med i R.</p>
<ul>
<li>Konstruera en funktion</li>
</ul>
<pre class="r"><code>get_songs &lt;- function(channel, date){
  ...
}</code></pre>
<p>som hämtar låtlistan för ett givet <a href="http://api.sr.se/api/v2/channels/">kanalnummer</a> och datum. Begär svaret i JSON genom att avsluta anropet med <code>&amp;format=json</code>. Du kan konvertera det svar (<code>response</code>) du får av <code>GET</code> med <code>content(response, "text") %&gt;% jsonlite::fromJSON()</code>.</p>
<!-- ##### Skrapa Dramaten -->
<!-- På [Dramatens arkiv Rollboken](https://www.dramaten.se/rollboken?detail=&type=search_type_all&search=) kan man söka efter uppgifter om deras produktioner. Eftersom de tabeller som genereras inte är i standardformat blir det enklast att skrapa varje variabel för sig. Namn på [uppsättningarna från 2021](https://www.dramaten.se/rollboken?detail=&type=search_type_years&search=2021) får vi t.ex. med -->
<!-- ```{r, echo = TRUE} -->
<!-- url <- "https://www.dramaten.se/rollboken?detail=&type=search_type_years&search=2021" -->
<!-- page <- read_html(url) -->
<!-- elements <- html_elements(page, css = ".play-name") -->
<!-- html_text(elements)[-1] -->
<!-- ``` -->
<!-- (här tar `[-1]` bort första elementet, rubriken). -->
<!-- - Identifiera CSS-väljare och skrapa övriga kolumner i tabellen. -->
</div>
<div id="relational-dataset-repository" class="section level5">
<h5>Relational Dataset Repository</h5>
<p>Anslut till valfri databas på <a href="https://relational.fit.cvut.cz/">Relational Dataset Repository</a> och prova ställa frågor som ovan. En mer fulltändig version av IMDB finns till exempel i <code>db = "imdb_ijs"</code>. Glöm inte stänga anslutningen när du är färdig.</p>
<hr />
</div>
</div>
</div>
<div id="v32-mer-om-visualisering" class="section level2">
<h2><strong>v32</strong>: Mer om visualisering</h2>
<div id="kursmaterial-9" class="section level3">
<h3>Kursmaterial</h3>
<ul>
<li>Kieran Healy, <em>Data Visualization</em>, <a href="https://socviz.co/lookatdata.html">Kapitel 1</a>.</li>
<li>R4DS: <a href="https://r4ds.had.co.nz/graphics-for-communication.html">Kapitel 28</a>.</li>
</ul>
</div>
<div id="övningar-8" class="section level3">
<h3>Övningar</h3>
<ul>
<li>Gå igenom dina figurer från laborationer, kan de förbättras?</li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
